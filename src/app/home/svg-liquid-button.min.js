/**
 * Liquid SVG Button
 * Author: Edgar Bermejo
 * Version: 0.1.0 Beta
 *
 * MIT License
 *
 * Copyright (c) 2017 Edgar Bermejo
 *
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is
 *  furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 *  copies or substantial portions of the Software.
 *
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 *  SOFTWARE.
 */

'use strict';var _createClass=function(){function a(b,c){for(var g,e=0;e<c.length;e++)g=c[e],g.enumerable=g.enumerable||!1,g.configurable=!0,'value'in g&&(g.writable=!0),Object.defineProperty(b,g.key,g)}return function(b,c,e){return c&&a(b.prototype,c),e&&a(b,e),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var LiquidButton=function(){function a(b){_classCallCheck(this,a),this.btn=b,this.pathDef='',this.padding=parseFloat(this.btn.dataset.padding)||20,this.margin=1,this.gap=1,this.rect=this.btn.getBoundingClientRect(),this.r=0.5*(this.rect.height-this.padding),this.width=this.rect.width-2*this.padding,this.height=this.rect.height-2*this.padding,this.touches=[],this.tension=0.4,this.hoverFactor=-0.1,this.forceFactor=0.2;var c=this.btn.dataset.gradient.split(',');this.stop=0,this.colorStops=[{offset:this.stop+'%','stop-color':c[0]},{offset:this.stop+50+'%','stop-color':c[1]}],this.layers=[{points:[],viscosity:0.7,mouseForce:1200,forceLimit:2},{points:[],viscosity:0.5,mouseForce:900,forceLimit:3}],this.createPaths(),this.createPlaceholder(),this.createBackgrounds(),this.points=this.calculateAreaPoints(),this.createButton(b),this.btn.addEventListener('mouseover',this.mouseover,!1),this.btn.addEventListener('mouseout',this.mouseout,!1),this.btn.addEventListener('click',this.click,!1),window.addEventListener('resize',this.resize.bind(this),!1),this.resize(),this.animate()}return _createClass(a,[{key:'createPaths',value:function createPaths(){this.svg=this.btn.querySelector('svg'),this.path=document.createElementNS('http://www.w3.org/2000/svg','path'),this.path2=document.createElementNS('http://www.w3.org/2000/svg','path'),this.svg.appendChild(this.path2),this.svg.appendChild(this.path)}},{key:'createPlaceholder',value:function createPlaceholder(){var b=document.createElementNS('http://www.w3.org/2000/svg','text');b.textContent=this.btn.dataset.placeholder||'',b.setAttribute('x','50%'),b.setAttribute('y','50%'),b.setAttribute('dy','0.2em'),b.setAttribute('style',this.btn.dataset.textstyle||'fill: white;'),b.setAttribute('alignment-baseline','middle'),b.setAttribute('text-anchor','middle'),b.setAttribute('pointer-events','none'),this.svg.appendChild(b)}},{key:'createBackgrounds',value:function createBackgrounds(){this.gradient=document.createElementNS('http://www.w3.org/2000/svg','linearGradient');var b=this.udid+'-gradient';this.gradient.setAttribute('id',b),this.gradient.setAttribute('gradientTransform','rotate(35)');for(var c=0;c<this.colorStops.length;c++){var e=this.colorStops[c],g=document.createElementNS('http://www.w3.org/2000/svg','stop');for(var h in e)e.hasOwnProperty(h)&&g.setAttribute(h,e[h]);this.gradient.appendChild(g)}this.svg.appendChild(this.gradient),this.path.setAttribute('fill','url(#'+b+')'),this.path2.setAttribute('fill',this.btn.dataset.basecolor),this.updateGradient(30)}},{key:'createButton',value:function createButton(){var e=this,b='',c='';this.layers[1].points.map(function(g,h){var k=e.layers[1].points[h+1]?e.layers[1].points[h+1]:e.layers[1].points[0],l=0===h?'M':'C';b=0===h?b+' '+l+' '+g.x+', '+g.y:b+' '+l+' '+g.x+' '+g.y+', '+k.x+' '+k.y+', '+g.x+' '+g.y}),this.layers[0].points.map(function(g,h){var k=e.layers[0].points[h+1]?e.layers[0].points[h+1]:e.layers[0].points[0],l=0===h?'M':'L';c=0===h?c+' '+l+' '+g.x+', '+g.y:c+' '+l+' '+g.x+' '+g.y+', '+k.x+' '+k.y+', '+g.x+' '+g.y}),this.path.setAttribute('d',b),this.path2.setAttribute('d',c)}},{key:'calculateAreaPoints',value:function calculateAreaPoints(){for(var c=this.layers.length,e=0;e<c;e++){for(var g=this.layers[e],h=[],k=~~(this.height/2);k<this.width-~~(this.height/2);k+=this.gap)h.push(this.createPoint(k+this.margin+this.padding,this.margin+this.padding));for(var l=~~(1.25*this.height);0<=l;l-=this.gap){var m=Math.PI/~~(1.25*this.height)*l,n=Math.sin(m)*this.height/2+(this.margin+this.padding)+this.width-this.height/2,o=Math.cos(m)*this.height/2+(this.margin+this.padding)+this.height/2;h.push(this.createPoint(n,o))}for(var p=this.width-~~(this.height/2)-1;p>=~~(this.height/2);p-=this.gap)h.push(this.createPoint(p+this.margin+this.padding,this.margin+this.height+this.padding));for(var q=0;q<=~~(1.25*this.height);q+=this.gap){var r=Math.PI/~~(1.25*this.height)*q,s=this.height-Math.sin(r)*this.height/2+(this.margin+this.padding)-this.height/2,t=Math.cos(r)*this.height/2+(this.margin+this.padding)+this.height/2;h.push(this.createPoint(s,t))}g.points=h}}},{key:'createPoint',value:function createPoint(b,c){return{x:b,y:c,ox:b,oy:c,vx:0,vy:0}}},{key:'update',value:function update(){for(var b=this.layers.length,c=0;c<b;c++)for(var e=this.layers[c],g=e.points,h=g.length,k=0;k<h;k++){var l=g[k],m=l.ox-l.x+(Math.random()-0.5),n=l.oy-l.y+(Math.random()-0.5),o=Math.sqrt(m*m+n*n),p=o*this.forceFactor;l.vx+=p*(m/o||0),l.vy+=p*(n/o||0);for(var q=0;q<this.touches.length;q++){var r=this.touches[q],s=e.mouseForce;r.x>this.margin&&r.x<this.margin+this.width&&r.y>this.margin&&r.y<this.margin+this.height&&(s*=-this.hoverFactor);var t=l.x-r.x,u=l.y-r.y,v=Math.sqrt(t*t+u*u),w=Math.max(-e.forceLimit,Math.min(e.forceLimit,s*r.force/v));l.vx+=w*(t/v||0),l.vy+=w*(u/v||0)}if(l.vx*=e.viscosity,l.vy*=e.viscosity,l.x+=l.vx,l.y+=l.vy,0<this.touches.length){var z=100*(this.touches[0].x/this.width);this.updateGradient(z)}}}},{key:'updateGradient',value:function updateGradient(b){if(!(70<b)){var c=this.gradient.querySelectorAll('stop'),e=c[0],g=c[1];e.setAttribute('offset',b+'%'),g.setAttribute('offset',b+50+'%')}}},{key:'animate',value:function animate(){var b=this;this.raf(function(){b.update(),b.createButton(),b.animate()})}},{key:'distance',value:function distance(b,c){return Math.sqrt(Math.pow(b.x-c.x,2)+Math.pow(b.y-c.y,2))}},{key:'resize',value:function resize(){this.rect=this.btn.getBoundingClientRect(),this.r=0.5*(this.rect.height-this.padding),this.width=this.rect.width-2*this.padding,this.height=this.rect.height-2*this.padding,300<this.width&&(this.gap=3),500<this.width&&(this.gap=5),this.points=this.calculateAreaPoints()}},{key:'mouseover',get:function get(){var b=this;return function(){b.btn.addEventListener('mousemove',b.mousemove,!1)}}},{key:'mousemove',get:function get(){var b=this;return function(c){b.touches=[{x:c.offsetX,y:c.offsetY,z:0,force:1}]}}},{key:'mouseout',get:function get(){var b=this;return function(){b.touches=[],b.btn.removeEventListener('mousemove',b.mousemove,!1)}}},{key:'click',get:function get(){var b=this;return function(){console.log(b)}}},{key:'raf',get:function get(){return this.__raf||(this.__raf=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(b){setTimeout(b,60)}).bind(window))}},{key:'udid',get:function get(){return Math.random().toString(16).slice(-4)}}]),a}();